!function s(r,a,c){function h(e,t){if(!a[e]){if(!r[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(u)return u(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var i=a[e]={exports:{}};r[e][0].call(i.exports,function(t){var n=r[e][1][t];return h(n||t)},i,i.exports,s,r,a,c)}return a[e].exports}for(var u="function"==typeof require&&require,t=0;t<c.length;t++)h(c[t]);return h}({1:[function(o,t,n){!function(t){"use strict";var n=t.dom||o("./dom.js"),e=t.Main||o("./components/main.js");t.main=new e({element:n.body()}),n.export("scene",t.main.scene()),t.main.load()}(this.app||(this.app={}))},{"./components/main.js":9,"./dom.js":12}],2:[function(i,r,t){!function(t){"use strict";var n,e=i("jcore"),s=t.dom||i("../dom.js"),o=e.Component.inherits(function(t){this.type=this.prop(t.type),this.x=this.prop(t.x),this.y=this.prop(t.y),this.isActive=this.prop(!1),this.draggable=new o.Draggable(this)});o.prototype.render=function(){return s.render(o.HTML_TEXT)},o.prototype.oninit=function(){this.draggable.enable()},o.prototype.onredraw=function(){this.redrawBy("type",function(t){s.data(this.element(),"type",t)}),this.redrawBy("x","y",function(t,n){s.translate(this.element(),t/.045*100-50,n/.08*100-50)}),this.redrawBy("isActive",function(t){s.toggleClass(this.element(),"active",t)})},o.HTML_TEXT='<div class="action"><div class="action-image"></div></div>',o.Draggable=((n=e.Draggable.inherits()).prototype.onstart=function(t,n,e,o,i){i.target=s.target(o),s.cancel(o),t.isActive(!0)},n.prototype.onmove=function(t,n,e,o,i){t.isActive(s.target(o)===i.target)},n.prototype.onend=function(t,n,e,o,i){s.target(o)===i.target&&t.emit("tap")},n),void 0!==r&&r.exports?r.exports=o:t.Action=o}(this.app||(this.app={}))},{"../dom.js":12,jcore:void 0}],3:[function(i,s,t){!function(t){"use strict";var n=i("jcore"),o=t.dom||i("../dom.js"),e=n.Component.inherits(function(){this.background=""});e.prototype.change=function(e){return this.background===e?Promise.resolve():(this.background=e,new Promise(function(t){var n=o.children(this.element());o.once(this.element(),"transitionend",function(){o.append(this.element(),n[0]),o.css(n[1],{background:e}),o.css(this.element(),{background:e}),t()}.bind(this)),o.css(n[0],{background:e,opacity:1}),o.css(n[1],{opacity:0})}.bind(this)))},e.prototype.oninit=function(){var t=o.children(this.element());o.css(t[0],{opacity:0}),o.css(t[1],{opacity:1})},void 0!==s&&s.exports?s.exports=e:t.Background=e}(this.app||(this.app={}))},{"../dom.js":12,jcore:void 0}],4:[function(i,r,t){!function(t){"use strict";var n,e=i("jcore"),s=t.dom||i("../dom.js"),o=e.Component.inherits(function(){this.isActive=this.prop(!1),this.disabled=this.prop(!1),this.draggable=new o.Draggable(this)});o.prototype.oninit=function(){this.draggable.enable()},o.prototype.onredraw=function(){this.redrawBy("isActive",function(t){s.toggleClass(this.element(),"active",t)}),this.redrawBy("disabled",function(t){s.toggleClass(this.element(),"disabled",t)})},o.Draggable=((n=e.Draggable.inherits()).prototype.onstart=function(t,n,e,o,i){i.target=s.target(o),s.cancel(o),t.isActive(!0)},n.prototype.onmove=function(t,n,e,o,i){t.isActive(s.target(o)===i.target)},n.prototype.onend=function(t,n,e,o,i){t.isActive(!1),s.target(o)===i.target&&t.emit("tap")},n),void 0!==r&&r.exports?r.exports=o:t.Button=o}(this.app||(this.app={}))},{"../dom.js":12,jcore:void 0}],5:[function(o,s,t){!function(t){"use strict";var n=o("jcore"),i=t.dom||o("../dom.js"),e=n.Component.inherits(function(t){this.x=this.prop(t.x),this.y=this.prop(t.y),this.z=this.prop(t.z),this.w=this.prop(t.w),this.h=this.prop(t.h)});e.prototype.load=function(o){return new Promise(function(t){var n=this.findElement(".content-item-image"),e=function(){i.attr(n,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYWH5DwABKAEMOPUkGQAAAABJRU5ErkJggg=="})}.bind(this);i.once(n,"load",function(){i.off(n,"error",e),i.off(n,"abort",e),t(this)}.bind(this)),i.on(n,"error",e),i.on(n,"abort",e),i.attr(n,{src:o})}.bind(this))},e.prototype.show=function(){return new Promise(function(t){i.once(this.element(),"transitionend",function(){t()}.bind(this)),i.css(this.element(),{opacity:1})}.bind(this))},e.prototype.hide=function(){return new Promise(function(t){i.once(this.element(),"transitionend",function(){t()}.bind(this)),i.css(this.element(),{opacity:0})}.bind(this))},e.prototype.render=function(){return i.render(e.HTML_TEXT)},e.prototype.onredraw=function(){this.redrawBy("x","y","w","h",function(t,n,e,o){i.translate(this.element(),t/e*100,n/o*100),i.css(this.element(),{height:100*o+"%",width:100*e+"%"})}),this.redrawBy("z",function(t){i.css(this.element(),{zIndex:parseInt(100*t,10)})})},e.HTML_TEXT=['<div class="content-item">','<img class="content-item-image">',"</div>"].join(""),void 0!==s&&s.exports?s.exports=e:t.ContentItem=e}(this.app||(this.app={}))},{"../dom.js":12,jcore:void 0}],6:[function(i,s,t){!function(t){"use strict";var n=i("jcore"),e=t.ContentItem||i("./content-item.js"),o=n.Component.inherits(function(){this.materials=[],this.previousMaterials=[],this.characters=[],this.previousCharacters=[]});o.prototype.loadMaterials=function(t){return Promise.all(t.map(function(t){var n="images/materials/"+t.name+".svg";return new e(t).load(n)})).then(function(t){this.previousMaterials=this.materials,this.materials=t}.bind(this))},o.prototype.showMaterials=function(){return this.showItems(this.materials)},o.prototype.hideMaterials=function(){return this.hideItems(this.previousMaterials)},o.prototype.loadCharacters=function(t){return Promise.all(t.map(function(t){var n="images/characters/"+t.name+".svg";return new e(t).load(n)})).then(function(t){this.previousCharacters=this.characters,this.characters=t}.bind(this))},o.prototype.showCharacters=function(){return this.showItems(this.characters)},o.prototype.hideCharacters=function(){return this.hideItems(this.previousCharacters)},o.prototype.showItems=function(t){return Promise.all(t.map(function(t){return t.parentElement(this.element()),t.redraw(),t}.bind(this))).then(function(t){return new Promise(function(t){setTimeout(function(){t()},1e3/15)}).then(function(){return Promise.all(t.map(function(t){return t.show()}))})})},o.prototype.hideItems=function(t){return Promise.all(t.map(function(t){return t.hide().then(function(){t.parentElement(null),t.redraw()})}))},void 0!==s&&s.exports?s.exports=o:t.Content=o}(this.app||(this.app={}))},{"./content-item.js":5,jcore:void 0}],7:[function(u,p,t){!function(t){"use strict";var n,e,o=u("jcore"),i=t.helper||u("../helper.js"),s=t.dom||u("../dom.js"),r=t.Action||u("./action.js"),a=t.Medal||u("./medal.js"),c=t.MuteButton||u("./mute-button.js"),h=o.Component.inherits(function(){this.actionContainer=new h.ActionContainer({element:this.findElement(".action-container")}),this.medal=new a({element:this.findElement(".medal")}),this.playerContainer=new h.PlayerContainer({element:this.findElement(".player-container")}),this.muteButton=new c({element:this.findElement(".mute-button")})});h.prototype.loadActions=function(t,e){return this.actionContainer.load(t.map(function(t){var n=new r({type:t.next.medal===e?"amber":"pink",x:t.x,y:t.y});return n.on("tap",this.emit.bind(this,"action",t.name,i.clone(t.next))),n}.bind(this)))},h.prototype.showActions=function(){return this.actionContainer.show()},h.prototype.hideActions=function(){return this.actionContainer.hide()},h.prototype.enableActions=function(){this.actionContainer.enable()},h.prototype.disableActions=function(){this.actionContainer.disable()},h.prototype.playAction=function(t){return this.playerContainer.play(t)},h.prototype.hidePlayer=function(){return this.playerContainer.hide()},h.prototype.loadMedal=function(t){return this.medal.change(t)},h.prototype.oninit=function(){this.muteButton.on("mute",this.emit.bind(this,"mute")),this.muteButton.on("unmute",this.emit.bind(this,"unmute"))},h.ActionContainer=((n=o.Component.inherits(function(){this.actions=[]})).prototype.load=function(n){return new Promise(function(t){this.actions.forEach(function(t){t.removeAllListeners(),t.parentElement(null),t.redraw()}),n.forEach(function(t){t.parentElement(this.element()),t.redraw()}.bind(this)),this.actions=n,t()}.bind(this))},n.prototype.show=function(){return new Promise(function(t){s.once(this.element(),"transitionend",function(){t()}.bind(this)),s.css(this.element(),{opacity:1})}.bind(this))},n.prototype.hide=function(){return new Promise(function(t){s.once(this.element(),"transitionend",function(){t()}.bind(this)),s.css(this.element(),{opacity:0})}.bind(this))},n.prototype.enable=function(){s.css(this.element(),{"pointer-events":"auto"})},n.prototype.disable=function(){s.css(this.element(),{"pointer-events":"none"})},n),h.PlayerContainer=((e=o.Component.inherits()).prototype.playerElement=function(){return this.findElement(".player")},e.prototype.playerContentWindow=function(){return s.contentWindow(this.playerElement())},e.prototype.play=function(e){return this.show().then(function(){return new Promise(function(t){var n="actions/"+e+".html";s.once(this.playerElement(),"load",function(){s.once(this.playerContentWindow(),"message",function(){t()}.bind(this))}.bind(this)),s.replace(this.playerElement(),n)}.bind(this))}.bind(this))},e.prototype.show=function(){return new Promise(function(t){s.once(this.element(),"transitionend",function(){t()}.bind(this)),s.css(this.element(),{opacity:1,visibility:"visible"})}.bind(this))},e.prototype.hide=function(){return new Promise(function(t){s.once(this.element(),"transitionend",function(){s.css(this.element(),{visibility:"hidden"}),t()}.bind(this)),s.css(this.element(),{opacity:0})}.bind(this)).then(function(){s.replace(this.playerElement(),"about:blank")}.bind(this))},e),void 0!==p&&p.exports?p.exports=h:t.Controls=h}(this.app||(this.app={}))},{"../dom.js":12,"../helper.js":13,"./action.js":2,"./medal.js":10,"./mute-button.js":11,jcore:void 0}],8:[function(o,s,t){!function(t){"use strict";var n=o("jcore"),i=t.dom||o("../dom.js"),e=n.Component.inherits(function(){this.background="",this.opacity=0});e.prototype.change=function(e,o){return this.background===e&&this.opacity===o?Promise.resolve():(this.background=e,this.opacity=o,new Promise(function(t){var n=i.children(this.element());i.once(this.element(),"transitionend",function(){i.append(this.element(),n[0]),i.css(n[1],{background:e}),t()}.bind(this)),i.css(n[0],{background:e,opacity:void 0!==o?o:1}),i.css(n[1],{opacity:0})}.bind(this)))},e.prototype.oninit=function(){var t=i.children(this.element());i.css(t[0],{opacity:0}),i.css(t[1],{opacity:1})},void 0!==s&&s.exports?s.exports=e:t.Foreground=e}(this.app||(this.app={}))},{"../dom.js":12,jcore:void 0}],9:[function(u,p,t){!function(t){"use strict";var n,e=u("howler"),o=u("jcore"),i=t.dom||u("../dom.js"),s=t.Background||u("./background.js"),r=t.Content||u("./content.js"),a=t.Controls||u("./controls.js"),c=t.Foreground||u("./foreground.js"),h=o.Component.inherits(function(){this.medal="",this.sound=new h.Sound,this.history=[],this.background=new s({element:this.findElement(".background")}),this.content=new r({element:this.findElement(".content")}),this.foreground=new c({element:this.findElement(".foreground")}),this.controls=new a({element:this.findElement(".controls")})});h.prototype.scene=function(){return Object.create(Object.prototype,{load:{value:this.loadSceneWithCallback.bind(this)}})},h.prototype.load=function(){var t=i.load("current",null);return t?Promise.all([this.loadMedal(t.medal),this.loadScene(t.scene)]):i.loadScript("scenes/index.js")},h.prototype.loadScene=function(t){return Promise.all([this.content.loadMaterials(t.materials||[]),this.content.loadCharacters(t.characters||[]),this.sound.load(t.sound||"")]).then(function(){return Promise.all([this.background.change(t.background||"#ffffff"),this.foreground.change.apply(this.foreground,t.foreground||["#ffffff",0]),this.content.hideMaterials(),this.content.hideCharacters(),this.content.showMaterials()])}.bind(this)).then(function(){return this.content.showCharacters()}.bind(this)).then(function(){return this.controls.loadActions(t.actions||[],this.medal).then(function(){return this.controls.showActions()}.bind(this)).then(function(){this.controls.enableActions()}.bind(this))}.bind(this)).then(function(){return this.sound.play()}.bind(this)).then(function(){i.save("current",{medal:this.medal,scene:t})}.bind(this))},h.prototype.loadSceneWithCallback=function(t){return this.loadScene(t(this.history.slice()))},h.prototype.loadMedal=function(t){return this.medal=t,this.controls.loadMedal(t)},h.prototype.oninit=function(){this.controls.on("action",this.onaction.bind(this)),this.controls.on("mute",this.onmute.bind(this)),this.controls.on("unmute",this.onunmute.bind(this)),this.sound.mute()},h.prototype.onaction=function(t,n){this.history.push(Object.freeze({action:t,medal:n.medal,scene:n.scene})),this.controls.disableActions(),this.controls.playAction(t).then(function(){return Promise.all([this.controls.hidePlayer(),this.controls.hideActions(),this.loadMedal(n.medal)])}.bind(this)).then(function(){return i.loadScript("scenes/"+n.scene+".js")})},h.prototype.onmute=function(){this.sound.mute()},h.prototype.onunmute=function(){this.sound.unmute()},h.Sound=((n=function(){this.name="",this.howl=null}).prototype.load=function(n){return this.name===n?Promise.resolve():(this.name=n,new Promise(function(t){if(!this.howl)return t();this.howl.once("fade",function(){this.howl.unload(),this.howl=null,t()}.bind(this)),this.howl.fade(1,0,1e3)}.bind(this)).then(function(){return n?new Promise(function(t){this.howl=new e.Howl({src:["sounds/"+n+".mp3"],loop:!0}),t()}.bind(this)):Promise.resolve()}.bind(this)))},n.prototype.play=function(){return!this.howl||this.howl.playing()?Promise.resolve():new Promise(function(t){this.howl.play(),t()}.bind(this))},n.prototype.mute=function(){e.Howler.mute(!0)},n.prototype.unmute=function(){e.Howler.mute(!1)},n),void 0!==p&&p.exports?p.exports=h:t.Main=h}(this.app||(this.app={}))},{"../dom.js":12,"./background.js":3,"./content.js":6,"./controls.js":7,"./foreground.js":8,howler:void 0,jcore:void 0}],10:[function(o,i,t){!function(t){"use strict";var n=o("jcore"),s=t.dom||o("../dom.js"),e=n.Component.inherits(function(){this.name=""});e.prototype.change=function(i){return this.name===i?Promise.resolve():(this.name=i,new Promise(function(t){var n=s.children(this.element()),e="images/medals/"+i+".svg",o=function(){e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYWH5DwABKAEMOPUkGQAAAABJRU5ErkJggg==",s.attr(n[0],{src:e})};s.once(n[0],"load",function(){s.off(n[0],"error",o),s.off(n[0],"abort",o),s.once(this.element(),"transitionend",function(){s.append(this.element(),n[0]),s.attr(n[1],{src:e}),s.css(this.element(),{"background-image":'url("'+e+'")'}),t()}.bind(this)),s.css(n[0],{opacity:1}),s.css(n[1],{opacity:0})}.bind(this)),s.on(n[0],"error",o),s.on(n[0],"abort",o),s.attr(n[0],{src:e})}.bind(this)))},e.prototype.oninit=function(){var t=s.children(this.element());s.css(t[0],{opacity:0}),s.css(t[1],{opacity:1})},void 0!==i&&i.exports?i.exports=e:t.Medal=e}(this.app||(this.app={}))},{"../dom.js":12,jcore:void 0}],11:[function(s,r,t){!function(t){"use strict";var n=s("jcore"),e=t.dom||s("../dom.js"),o=t.Button||s("./button.js"),i=n.Component.inherits(function(t){this.states=["mute","unmute"],this.stateIndex=this.prop(0),this.button=new o({element:t.element})});i.prototype.state=function(){return this.states[this.stateIndex()]},i.prototype.toggle=function(){this.stateIndex((this.stateIndex()+1)%this.states.length)},i.prototype.oninit=function(){this.button.on("tap",this.ontap.bind(this))},i.prototype.onredraw=function(){this.redrawBy("state",function(t){e.data(this.element(),"state",t)})},i.prototype.ontap=function(){this.toggle(),this.emit(this.state())},void 0!==r&&r.exports?r.exports=i:t.MuteButton=i}(this.app||(this.app={}))},{"../dom.js":12,"./button.js":4,jcore:void 0}],12:[function(t,n,e){(function(o){!function(t){"use strict";var s={export:function(t,n){var e=void 0!==o?o:window;Object.defineProperty(e,t,{value:n})},body:function(){return document.body},render:function(t){var n=document.createRange().createContextualFragment(t).firstChild;return n.parentNode.removeChild(n),n},children:function(t){return Array.prototype.slice.call(t.children)},append:function(t,n){t.appendChild(n)},attr:function(n,e){Object.keys(e).forEach(function(t){n.setAttribute(t,e[t])})},css:function(t,n){var e=t.style;Object.keys(n).forEach(function(t){e[t]=n[t]})},toggleClass:function(t,n,e){e?t.classList.add(n):t.classList.remove(n)},data:function(t,n,e){t.dataset[n]=e},contentWindow:function(t){return t.contentWindow},replace:function(t,n){t.contentWindow.location.replace(n)},transform:function(t,n){s.css(t,{transform:n,webkitTransform:n})},translate:function(t,n,e){s.transform(t,"translate("+n+"%, "+e+"%)")},on:function(t,n,e,o){t.addEventListener(n,e,!!o)},off:function(t,n,e,o){t.removeEventListener(n,e,!!o)},once:function(t,n,e,o){var i=function(){s.off(t,n,i,o),e.apply(null,arguments)};s.on(t,n,i,o)},supportsTouch:function(){return"createTouch"in document},changedTouch:function(t){return s.supportsTouch()&&"changedTouches"in t?t.changedTouches[0]:null},target:function(t){var n=s.changedTouch(t);return n?document.elementFromPoint(n.clientX,n.clientY):t.target},cancel:function(t){t.preventDefault()},ajax:function(t){var i=t.type,s=t.url;return new Promise(function(t,n){var e=new XMLHttpRequest,o=function(){n(new Error("Failed to load resource: "+i+" "+s))};e.onload=function(){200<=e.status&&e.status<400?t(e.response):o()},e.onerror=o,e.onabort=o,e.open(i,s,!0),e.send()})},loadScript:function(t){return s.ajax({type:"GET",url:t}).then(function(t){var n=document.createElement("script");n.textContent=t,document.body.appendChild(n),document.body.removeChild(n)})},load:function(t,n){return JSON.parse(sessionStorage.getItem(t))||n},save:function(t,n){sessionStorage.setItem(t,JSON.stringify(n))}};void 0!==n&&n.exports?n.exports=s:t.dom=s}(this.app||(this.app={}))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(t,e,n){!function(t){"use strict";var n={extend:function(n,e){return Object.keys(e).forEach(function(t){n[t]=e[t]}),n},clone:function(t){return n.extend({},t)}};void 0!==e&&e.exports?e.exports=n:t.helper=n}(this.app||(this.app={}))},{}]},{},[1]);